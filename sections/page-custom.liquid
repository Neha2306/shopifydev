{% if customer %}

  
<form id="registrationform" class="registrationform" autocomplete="off" data-discover="true">
  <div class="form-group">
    <label for="firstname">First Name <span aria-hidden="true" style="color: red;">*</span></label>
    <input type="text" id="firstname" name="firstname" aria-required="true" value="">
  </div>
  <div class="form-group">
    <label for="lastname">Last Name <span aria-hidden="true" style="color: red;">*</span></label>
    <input type="text" id="lastname" name="lastname" aria-required="true" value="">
  </div>
  <div class="form-group">
    <label for="emailaddress">Email Address <span aria-hidden="true" style="color: red;">*</span></label>
    <input type="email" id="emailaddress" name="emailaddress" aria-required="true" value="">
  </div>
  <div class="form-group">
    <label for="contactnumber">Contact Number <span aria-hidden="true" style="color: red;">*</span></label>
    <input type="phone" id="contactnumber" name="contactnumber" aria-required="true" value="">
  </div>
  <input type="hidden" value="Demo@123456">
  <button type="button" id="registrationbutton">Create Customer</button>
</form>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('registrationform');
    const statusBox = document.getElementById('registrationbutton');

    form.addEventListener('click', function (event) {
      event.preventDefault();
      statusBox.textContent = 'Creating your account...';

      const formData = new FormData(form);

      const payload = {
        firstName: formData.get('firstname') || '',
        lastName: formData.get('lastname') || '',
        email: formData.get('emailaddress') || '',
        phone: formData.get('contactnumber') || '',
        emailMarketing: formData.get('emailMarketing') === 'on',
        smsMarketing: formData.get('smsMarketing') === 'on'
      };

      fetch('/apps/customer-dashboard/points', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          action: 'add_points',
          points: 50
        })
      })
      .then(async res => {
        const text = await res.text();   // üëà IMPORTANT
        console.log('RAW RESPONSE:', text);
      })
      .catch(err => console.error(err));

      {% comment %} jQuery.ajax({
        url: "http://localhost:5000/apps/customer-dashboard/points",
        method: "POST", // The HTTP method to use for the request
        dataType: "json", // The type of data that you‚Äôre exerciseecting back
        {% comment %} headers: {‚ÄúX-Shopify-Access-Token‚Äù: ‚Äú7a914f63fda68e2af725acd6bbfcaf51‚Äù}, {% endcomment %}
        {% comment %} headers: { 'Content-Type': 'application/json' }, {% endcomment %}
        data: payload,
        crossDomain: true,
        error: function(response) {
          console.log("error")
          console.log(response)
        // A function to be called if the request fails.
        },
        beforeSend: function(response) {
          console.log("beforesed")
          console.log(response)
        // A function to be called if before the request is made.
        },
        success: function(response) {
          console.log("success")
        console.log(response)
        // A function to be called if the request succeeds.
        }
      }); {% endcomment %}

      {% comment %} fetch('https://601e-13-93-119-81.ngrok-free.app/webhooks/orders-create', {  // <-- your app proxy or backend route
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Access-Control-Allow-Origin': '*'
        },
        crossDomain: true,
        body: JSON.stringify(payload)
      })
      .then(response => response.json())
      .then(data => {
        console.log("data");
        console.log(data);
        if (data.ok) {
          statusBox.style.color = 'green';
          statusBox.textContent = 'Account created successfully. Please check your email to log in.';
          // You can also redirect to new accounts login page if you want:
          // window.location.href = "{{ routes.account_login_url }}";
        } else {
          statusBox.style.color = 'red';
          statusBox.textContent = data.error || 'There was a problem creating your account.';
        }
      })
      .catch(err => {
        console.error('Registration error:', err);
        statusBox.style.color = 'red';
        statusBox.textContent = 'An unexpected error occurred. Please try again.';
      }); {% endcomment %}
    });
  });
</script>

{% else %}
  <script>
    window.location.replace("{{ routes.root_url }}");
  </script>
{% endif %}
{% schema %}
{
  "name": "Custom page content",
  "settings": [],
  "presets": [
    {
      "name": "Custom page content"
    }
  ]
}
{% endschema %}
